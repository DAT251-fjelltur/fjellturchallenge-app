# Check out https://docs.codemagic.io/getting-started/building-a-react-native-app/ for more information
# Please review and update values in curly braces

workflows:
  react-native:
    name: React Native App
    environment:
      vars:
        XCODE_WORKSPACE: "{{ fjellturchallenge-app }}"
        XCODE_SCHEME: "{{ fjellturchallenge-app }}"
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmdRaTJMdTNvc0xpX1ozYmFyY1VOY1pOYUZDMWVIdlIyb1Q1cnlHNnY4QmhyT2NMdmxISFBva3VTYWoxdjNZS2E3U2QxOHJiQm96eS1qU21seUFtcTNqd0ZNUEN2UTdVMDl1Z3pLWW5VZmxncFZGUnpBTmZ2ZTBjRWNiWlF5TDh4c09DVFk5ZDV1bFdTQ0JVdmFLQkh0RUlBVlByTUZBdVBLUDlsTE1hTFpRdkZRdEdpakNxbUZScXhDam9yNTdNSlc2c21xX0pDU1pyT1hrUWdMaWpCajRKYU1PSGZzdnlqVW51Rzc3djdlT2tJNFRYMXdJR2dkSTdKZVZyUU9jMFY4ajIzNkt1ZW1ZbVpxLUpwbFNydk8wOVg2LXF1MzZQSGJrN1owWHN5UU5Ycngxazd1SVNYZ19zcXZzb2wzSDE1c1JtWUtTMVNUM1pvaFBFVWwyOTB6Y2RfQW1NNDVEOGItY2JyUVk4UWJVTkEyelJrVmxTUHJmNmZ4dmRHSzZsUUVTb0p4LXZUV29VVFA1TlFqQVJDNXpxcHhmcDA2UmZpT3JfeHV6eEh6ZUNXRno3aEhidWtvdW1YekVZRlBHUjZaemEyU21ZTVR4NnlCUkQ5YkEwaWVFQUZhbS1RZURXaHFZSC1rN1lFT1ZzY0JpVUNBck9abE5LREs1SVpBOHc1Um9yMUE2QnhjeWh5blBPbmpuYlkxaVFCYTNQU19FdVM0TDcyY1BXRlNIV1RYT3NxV2ZHSnp0VG12dTdiUjFTZUZoLTlLbGNUYmN2RlRoMGFENlZtR19OM2xfTHVkV0UxdC1TYnFiYnh5NjNSZnlvd0Z3V0F5eWF4TDF2YnBlckVDRWViNks4SVZ2Z3c1TGFiRXh6MzNJNmpfNEpidEV0V05rNG5fYWNVV2IzamNiOGs5SXVZQjFnTnk0R0pTNm1IS0NmbWlXSHVkRHhFeDl0QW9fYVp0UjJ3RktlWlB4MW9tdm84NWM3LXFvMzJFN2I1Q0xmcDhPRmQ2alBiWkRVaE9XTjFlUGpDc1hjcDBYZVpkd1owMWEyWEdhQXpjUThjOVN2ZkIwTE1TVkRZYjFiX1RtRUs1akphbXNhMjJSaGJ0U1dEWjNydlprajZyY3cyT2VNakNpMmV0b3pMNlBIcjRTb01EMVk0bktkanVDRWp1NVhVY2JBUTJxS3QxNVF6SWJOZnpYbVZvTDU1V2hTajRsbDh2dGdvUXV1SWtIeWd1cWZjbVVWWGVQVDExZE9yR3Z6SEp1V3cxc01uTE5aZnBlUFo2NE5mWEp6UThZLXdrZEJRMzk1Ym9xR1JLR0NPcW9KbS1KVnp3cjVERDZjSTBKclh6S1ZtRnA4alNhcFd5clRqT3Y4OXI5SjNjMGR1VFAxZEh5d3BvTzdsSFFfaDdEN2Rqd2NtVFJnenJLODZ5Z0JZdEFTeGRSME9MX2VDTG9qNXQwbkxCc0lrNHFIWTlxSWVmSFBtMF82Y19qWG1Sc293LUhnOUlDZjVHUkgzNnFPV2xMTHptbUt2TFExMThvV1pFa0VpVzJlTDBJdGhFdmo4aEZQeDN5RGxlcloxRnpVTVNnQzlxQ295SDM2WThjODNBY3JlUzdheUsyQ29IXzVJZGRnelBXNTM3Z3hCWkF4bFVQdU5wMWYwVWVsOVgtVURnU2VEeW42cW5DZkVOYVpkMGdJSEZreDE2MXNid0lEVDZ0UHdSWDhFbDJMblB3Q3ZEdDdRaFNpWEZuYTVobEFyb05IV2xoYkVzRWowS2JxVVVPSjBXcm9BQUdGRVFqNTRBYVBKV2w3SkFMZ296cHJWWXdwYkluWmcyWkFxR3JZR1pVUGhKa3M5TWR4Wm4yVDlIRG1mT1I3UUdwMHFYTnU4NUx4Q2lPMERWS1ZzM05ocFlRQ0tRYWNrOGRoVXJETEtzVEZVdkhuVEJxQ1JBcnVjZlFvcnhWMVBBbDFCaXhnQWFqV0Q4WExtYUs2c3RoWVQ5bU5qN3d3N2l0Vy04QnR0aDFiZXJ6SGRWMDVnU0tqTGkyNlVUdHlZMnZJamxqbmdkbG5Icm1HclRTWXNHejRWekpGX253TVI3Vkc3U0ctUVV2a0ZCcmVUZGJGbm9MQ3JSWkhpY2c3ajIyWWJCX1RQcjNGWlAzUW5pbkFCQVZhRGo2WEJpT3RjVkxGSU9KckdIXzFZdGVBSVI3eWhMblE0Z0JleW9Hdk1VTWtrREVJQW5rQ1QyTHRTVzI3dW9kaXhTVENmLTEtNGVHZUdjZExTajNkZk4xMkFITUQydjJ3OUtKMGdSR0FxVXU0Nk9yR1ZNblJIVW9kZGp5SWhKSnlkak55SmNVbHFYWlZVWWE4QjlIYVNLeTMxanNwQ3hBcnktOXB0Z0hac05Ual9iM05HVzBodU5PSW50YnFZZ2lQTTQzVEZMOEpCNUhhR2tVNEJsaXJIZU03UU9tZ0MwRjhIN0RnTWUyNzRKMVltMzNKdW5jelNUSm1Qd2gzVTd6S1pSM0d5VkZrdDY1N0lzN3hVSnhjcktJMFlXUlhSQnNwQ21iUWR0aGV4VUFVcTI4SUQ3dFA4RXdNNi1wTWs2OFNwTHZfWDhneFliUnN4dG95VzEtT0ZzSmdoUmljRlBkLW05cF9RVFVrMFpzcWstclRKZlA3dmE0am1JTDI4MVBSVFJVdUdmc3lfcGxxaFpuWnZVMmxmRmhHT2lGTlI3RFZRVlBxTmhaM1pzUkZoUmR1S2NxTk9XalNGM1VuQ05TRnpkVU85RGU3TUJ2WXlUVlBrb0tJTzB5TFZWSkVJVE95NXBOVHBMbzZHWk5XenBjdGo1bHJYa3I2ZXluOEJMd0tQRkhXWjc4c2dNRnNORHozcEpERlBYT3JhOG14VUV0NzNxRV9UZU1tRWdKLUxOSzNoV0dIM1hTdUhBS1ZOd29Gb1h3ellBTUhBTS1Ta3IxMm5nQ2w3UWtPcGtEemp2aUoyazY2UlF2ZE4xZHoxVUpqWndCWW9PbkJFMUtVZXROcnZORHY5M1NjLWxnT0kyVmZOTTdwLWZfSUtQZXNUOW8zWmhzcFYxVl9XV3VvTVZ0MjdQbUtJTldEbE0zX3BadEE2ajRMdXZFaHpZMUhSaTVwc2Q1Z1RCQ2dmbjNwZE9IQ2xtcmZxdzRJZVVDdHNnOHgwaC1wN0l6RllkZUp1TEhIZjlnam9pNUh6a1ZRVENCRWRyb3YzbllTM04tenFpTXItc3hMNlRHR0VkcUtuWUtpV0hlVGFhRHFnSTdOUkZrUjh1dmVlT1NwT2luQXUwb2dsMW5TcUhhdDRqNEpEZ0JfVEVtRDN1bkFYR0VyeXdqbC1saFIyLVNvNEl0bnE0b01uQm5nTmhIeDNZMUJvQ2dpNnpDSHFlLTNqbzJMRXpERUREaG1MLUdSRHk3YzVJXzRSNzMzUFdpX0g0ZG5tNkg5eWNMaUxFcHdXM0JrSnExZ1lSOEwwc1M2RkJDRVJQZjF4Y0RTSEdhTFNUV1FZelJmX3J5RFd2RzJQaWFwSUZqdTREaHAwcFd1ek1KZVAyTTA2WFNQMTA5WlVJQXBFQjR4WnRHdWg5S0UzWU9BRVdIT2szU1NrdHR3ZkVUZk1YaVk1bHNkQTRhOVlVQzhiUENLR0ljVExxWV9aUGdkekNpaVJEN1FlUVJCVU9FVjhvc2NkSnNDUkpGSFpseVZPOUFrSktIYURZSldlclFZMFpUZFNveHVuV0Y0bm5nQkduSUN6SG84M0h1XzVmQmhpMnpzNHZPdzluQ3dnb3lxZDE0VlZjQ2JkOVFFUjBkRWpwamdvWHNlcGFtbl9PNTB3ZEtTd0pQanloVEUtVUotSEFpNUdfUjVaZjZVWFZTMUxldzJFMTlNTWZGVTRkNjc1LVZrbEk0Y0pFcDV5TTZkVWlEZ3ZzVm1tai03a2ZxWkRuZVJWRVIyY0RYZXlCV1RDWmZzd3ZWYlktazRGYTBycXlPR1Jmd0E1cHhWU2VIVXhHY0JsdXB6UlQ5V09pZ1VlOVNNTFk2bGRpOGMxRTQ1Z3BObkFtNk1hVUVkMG9oN1dXVm9DQlRGQVptOGs1bTZnUmpPSFYwai1iV3hKYmVJdENEUmZwNklnTDNkYk1hLU5aQ3FueEttX3daQVBib0xqSEtPV0xfbmJHbWk3MkxfYks4T1RsYlRXU09NUlhBS19rTkZMSjZoc09PQzNvX01YZHZRZHhVcWNKYWh0UUdIUURmdUNweld2MGJrWVhJM2ctWWJ1OTQxQ2tqc2VGbW1YaXEtemwzT0E0eWc5YW85T2ZuRHRpdGV1bm5CaGFQaGYyVEJaS2YxeGZMbVZWUy1GQXRlR1RJdFYwZzdoSmtfSmY1b21JY25kMHJSYVNpdlcwNU5ZZlRycVlpWDJrQUloamcyaHpVVENxZUtJMTc3aFpwajZpM0F0TDZwdFRmWFpfNG4xOFNtM1ZRMTUtSENkb2JWSjlMQld6dGN4QXhkZmEzVEZ3dERuYjY5RzNlM09Da3lROVNnZ0hUejFndTNyeWJQNmEyYlVqNC0xOVpyOFo4N3ZuYXFaTldpSVRhSVhuSE1aOXFKNEhjTzZCQ2M4ZF9VeDIxY2kwYzQ3STFqVEt1M1RhUDktM0g4eXZKWXVsZUxsYWVHcktqVnZqemxnOEFUVFBzYkN4TGFRaUZwV1pfTnNvMXowWTJoeDNnN1U0clV0WHJXREtfR3diZnVGUldBYnJ3OVlMZDdRdGdGZDUxWGdyR3VJMlBNd1FHS0ZIMG1kTU5YV1Q2TnNCQV9BUWJaNFlRQTF6Tk45LXRGaWpGbHc1YzlHVFdVMHdJS3FSQm1mVmhIUU5sYXNrUVZqc3E2UE1nTUVPczhsb0F2MFZWeVBreHl0QXQ3UmNENjRVR3NXNXFMU3lhNTlNcE43Sjg1SU9RUlllTDJEWERTYk9aN0ZYWjExcXFsOTdJbWNxZUtGR3d4VVNucllWbWJtNVVwQlBtV19HX1lUS1VTME54S0hWYmFUZmEyWkpuUGt1ZlpwZ2xyS2hsRW9FMjcwV0MydVc1VUQtQm41aWxkamZKUVF0bTA5R1RaemhOalQ5LXB4Sm1ORmw2SUpXV2pXME8tS1BpcllXa1VFMnZmZmFvS3VkQ0VFX3JwbzhFNXpkQTRKbUt1cmU3cGI1TFZtUkVubVoweW0yY2gtVU5VZEFCVkhvODVWWkFKZHNwaHRibXdUcTB0a2pEMHBNNkZYOTBKNFJRa0JaQlNBdDgyS0JOWm45ZnJsOVBHRF9sVzNEOFRIVmpUazdobllvenZUVXN1NjlJWDNPR01ZSGE0NVBVTkl2NmhzdmcxUjZ6SUR1X0x3SXlMZmxnQTZMVVdWX0RWWDg3QzdPLTlRcTBPbll1ejBjbl9YTXdhUGd4VGFlbzd2eTB0c2d3VW1vd2xuMDBkQ1pIcVh2TmhyQ25GdVNjbjJmZzZPVlBOdnVDTU1DbDFXc3IxVmlKcTZWcWxoUWVrRWtxcDVYTDQ3QUFnZGFwQWViWVl5UlZGNGdoOUJSUHl5SmpFcmpQbDJ2ZFZrWG45ckQ=)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdRakE3bVVYMVFsSHdtenJRSllUYXM1bHEtM1p4YjctaDE0c3lWUlUyN3phc3JRNzNWc0t0d19hZkdGVGZoRkdTV25WY09kZExzc3pkSG5OZV92R3docDdrbmNKSHd5ajZSRUxUV2M1a202VGlHNVppM0txeFpiTC1pbVYybmtqLXM0Q2VyN2R2QzVYY210SllOM1VfVExjVzRzYUF3bU1GRkt3N2tQYVhGal9FbHJnPQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmdRakROa0NLbUJ1MGluLVdCUjM3UFc4eXFxR3JqVGNsVktUZE5GRlMzdUZ4SUFVdEZxUUpUaUdGNDdoczBtQXFTOWY1MV9vOVZyendCUU85aEctckZLbzZSTHVuLXZQOXlRdnNDSkVwX1NFT3lwSElWb0xHQkE0Z3hEb2ltNWVReVlTM3Rtc3lqWnFHODFZWDFLNURXMmx2YmtiMVlVQUZCYzI2NGg3YzRrYzYybU4wPQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmdRakRhZWx0b09scGhnNDJDcGNkbUs5Ty05cTN2UGtJZERva1IwNVhIV190b3ZVd3BYazJNVkRiWTloYUZ2NHZaZlNfZEJRc0hlUjI0R0cwV2g3elJtemVqQWc9PQ==)
      node: latest
    scripts:
      - npm install
      - echo "sdk.dir=$HOME/programs/android-sdk-macosx" > "$FCI_BUILD_DIR/android/local.properties"
      - |
        chmod -R 777 $FCI_BUILD_DIR
        echo $CM_KEYSTORE | base64 --decode > $FCI_BUILD_DIR/keystore.jks
        # build Android
        cd android
        ./gradlew assembleRelease
      - |
        # build iOS
        cd ios
        pod install
        xcodebuild build -workspace "$XCODE_WORKSPACE.xcworkspace" -scheme "$XCODE_SCHEME" CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO
    artifacts:
      - android/app/build/outputs/**/*.apk
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM